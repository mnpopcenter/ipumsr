<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to `ipumsr` - IPUMS Data in R • ipumsr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Introduction to `ipumsr` - IPUMS Data in R">
<meta property="og:description" content="ipumsr">
<meta property="og:image" content="http://tech.popdata.org/ipumsr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipumsr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ipums.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ipums.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/value-labels.html">Value labels</a>
    </li>
    <li>
      <a href="../articles/ipums-geography.html">Geographic data in ipumsr</a>
    </li>
    <li>
      <a href="../articles/ipums-bigdata.html">Big IPUMS data</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/ipums-cps.html">CPS exercise</a>
    </li>
    <li>
      <a href="../articles/ipums-nhgis.html">NHGIS exercise</a>
    </li>
    <li>
      <a href="../articles/ipums-terra.html">IPUMS Terra exercise</a>
    </li>
    <li>
      <a href="https://ipums.org/exercises.shtml">More project exercises</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ipums/ipumsr">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://forum.ipums.org">
    <span class="fa fa-users"></span>
     
  </a>
</li>
<li>
  <a href="https://www.ipums.org/">
    <span class="fa fa-globe"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ipums_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to <code>ipumsr</code> - IPUMS Data in R</h1>
                        <h4 class="author">Minnesota Population Center</h4>
            
            <h4 class="date">2020-07-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ipums/ipumsr/blob/master/vignettes/ipums.Rmd"><code>vignettes/ipums.Rmd</code></a></small>
      <div class="hidden name"><code>ipums.Rmd</code></div>

    </div>

    
    
<p>The <code>ipumsr</code> package allows you to read data from your IPUMS extract into R along with the associated metadata like variable labels, value labels and more. IPUMS is a great source of international census and survey data.</p>
<blockquote>
<p>IPUMS provides census and survey data from around the world integrated across time and space. IPUMS integration and documentation makes it easy to study change, conduct comparative research, merge information across data types, and analyze individuals within family and community context. Data and services are available free of charge.</p>
</blockquote>
<p>Learn more here: <a href="https://ipums.org/what-is-ipums" class="uri">https://ipums.org/what-is-ipums</a></p>
<div id="additional-vignettes" class="section level2">
<h2 class="hasAnchor">
<a href="#additional-vignettes" class="anchor"></a>Additional Vignettes</h2>
<p>This vignette gives the basic outline of the <code>ipumsr</code> package. Additional vignettes provide guidance on working with IPUMS value labels, IPUMS geographic data, and data from three specific IPUMS projects – CPS, NHGIS, and Terra.</p>
<p>To view any of these additional vignettes, run one the following commands after installing the <code>ipumsr</code> package:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span>(<span class="st">"value-labels"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"ipumsr"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span>(<span class="st">"ipums-geography"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"ipumsr"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span>(<span class="st">"ipums-cps"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"ipumsr"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span>(<span class="st">"ipums-nhgis"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"ipumsr"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span>(<span class="st">"ipums-terra"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"ipumsr"</span>)</pre></body></html></div>
</div>
<div id="getting-data-from-the-ipums-website" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-data-from-the-ipums-website" class="anchor"></a>Getting Data from the IPUMS website</h2>
<p>Registered users can download IPUMS data from our website at <a href="https://www.ipums.org" class="uri">https://www.ipums.org</a>. The website provides an interactive extract system that allows you to select only the samples and variables that are relevant to your research question.</p>
<p><strong>For microdata projects (all supported projects except NHGIS and IPUMS Terra)</strong>, once you have created your extract, you should choose to download your data in either a fixed-width text (.dat file extension) or comma delimited (.csv file extension) format.</p>
<p>Once your extract is complete, download the data file and the DDI. Downloading the DDI is a little bit different depending on your browser. On most browsers you should right-click the file and select “Save As…”. If this saves a file with a .xml file extension, then you should be ready. However, Safari users must select “Download Linked File” instead of “Download Linked File <strong>As</strong>”. On Safari, selecting the wrong version of these two will download a file with a .html file extension instead of a .xml extension.</p>
<div class="figure">
<img src="microdata_annotated_screenshot.png" width="700" alt=""><p class="caption">Annotated screenshot for downloading microdata (may look different on your computer)</p>
</div>
<p><strong>For NHGIS</strong>, download the table data in a comma delimited format, and, if you want the associated mapping data, the GIS data. NHGIS provides the option to download comma-delimited files with an extra header row; it does not matter which option you select.</p>
<p><strong>For IPUMS Terra</strong>, download the .zip extract “bundles”. If you want the associated mapping data, select the “include boundary files” option. You do not need to unzip the data.</p>
</div>
<div id="import-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#import-functions" class="anchor"></a>Import Functions</h2>
<p>Once your extract is downloaded, the <code>ipumsr</code> package functions <code>read_*()</code> help you load the data into R.</p>
<ul>
<li>
<code><a href="../reference/read_ipums_micro.html">read_ipums_micro()</a></code> / <code><a href="../reference/read_ipums_micro.html">read_ipums_micro_list()</a></code>: Reads data from microdata projects (USA, CPS, International, DHS, Time Use, Health Surveys and Higher Ed)</li>
<li>
<code><a href="../reference/read_nhgis.html">read_nhgis()</a></code> / <code><a href="../reference/read_nhgis.html">read_nhgis_sf()</a></code> / <code><a href="../reference/read_nhgis.html">read_nhgis_sp()</a></code>: Reads data from the NHGIS project. <code>read_nhgis</code> loads only tabular data, whereas <code><a href="../reference/read_nhgis.html">read_nhgis_sf()</a></code> and <code><a href="../reference/read_nhgis.html">read_nhgis_sp()</a></code> load tabular data and shapefiles.</li>
<li>
<code><a href="../reference/read_terra_micro.html">read_terra_micro()</a></code>, <code>read_terra_micro_sf()</code>, <code>read_terra_micro_sp()</code>, <code><a href="../reference/read_terra_area.html">read_terra_area()</a></code> and <code><a href="../reference/read_terra_raster.html">read_terra_raster()</a></code> load data form the IPUMS Terra project.</li>
<li>
<code><a href="../reference/read_ipums_sf.html">read_ipums_sf()</a></code> and <code><a href="../reference/read_ipums_sf.html">read_ipums_sp()</a></code> load boundary files.</li>
<li>
<code><a href="../reference/read_ipums_ddi.html">read_ipums_ddi()</a></code>: Reads DDI files with metadata that are included with some extracts (mainly microdata)</li>
<li>
<code><a href="../reference/read_ipums_codebook.html">read_ipums_codebook()</a></code>: Reads the text codebook included with some extracts (mainly NHGIS and some TerraPop extracts)</li>
</ul>
</div>
<div id="metadata-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#metadata-functions" class="anchor"></a>Metadata Functions</h2>
<p>Once the data is in R, you can view information about the extract using the metadata functions.</p>
<ul>
<li>
<code><a href="../reference/ipums_view.html">ipums_view()</a></code>: Makes a webpage that displays in the RStudio Viewer which provides information about the extract as a whole (like your extract notes or the citation information) and the specific variables included (like the variable label, description and value labels).</li>
<li>
<code><a href="../reference/ipums_file_info.html">ipums_file_info()</a></code>: Returns the file-level metadata contained in <code><a href="../reference/ipums_view.html">ipums_view()</a></code> as an R data structure.</li>
<li>
<code><a href="../reference/ipums_var_info.html">ipums_var_info()</a></code>: Returns the variable-level metadata contained in <code><a href="../reference/ipums_view.html">ipums_view()</a></code> as an R data structure.</li>
</ul>
</div>
<div id="grab-bag" class="section level2">
<h2 class="hasAnchor">
<a href="#grab-bag" class="anchor"></a>Grab Bag</h2>
<div id="survey-weights" class="section level3">
<h3 class="hasAnchor">
<a href="#survey-weights" class="anchor"></a>Survey Weights</h3>
<p>The data from most IPUMS projects contain some form of weighting variable that should be used to calculate estimates that are representative of the whole population. Many projects also provide specifications to help estimate variance given the complex design of the survey, such as replicate weights or design variables like STRATUM and PSU. The <a href="https://cran.r-project.org/package=survey">survey package</a> provides functions that allow you to estimate variance taking this into account, and the <a href="https://cran.r-project.org/package=srvyr">srvyr package</a> implements dplyr-like syntax for survey analysis, using the survey package’s functions.</p>
<p>For more information about what these variables mean and how to use them, see the website for the project you are interested in.</p>
</div>
<div id="non-extract-data" class="section level3">
<h3 class="hasAnchor">
<a href="#non-extract-data" class="anchor"></a>Non-Extract Data</h3>
<p>Some projects have data that is not contained within the extract system, such that no DDI is provided for this data. In this case, either use the comma delimited file (.csv file extension) if available, or use the <code>haven</code> package to read one of the files intended for another statistical software (like Stata, SAS or SPSS).</p>
</div>
<div id="value-labels" class="section level3">
<h3 class="hasAnchor">
<a href="#value-labels" class="anchor"></a>Value Labels</h3>
<p>The way that IPUMS treats value labels does not align with factors (the main way that R is able to store values associated with labels). R’s <code>factor</code> variables can only store values as an integer sequence (1, 2, 3, …), but IPUMS conventions are to store missing and not-in-universe codes as large numbers, to distinguish them from the normal values.</p>
<p>Therefore, the <code>ipumsr</code> package uses the <code>labelled</code> class from the <code>haven</code> package to store labelled values. See the “value-labels” vignette for more information (<code><a href="../articles/value-labels.html">vignette('value-labels')</a></code>).</p>
<p>If you want to use IPUMS value labels attached to a variable, it is generally best to convert from the <code>labelled</code> class to <code>factor</code> early on in your data analysis workflow. This is because many data manipulation functions will drop the labels stored in a variable with class <code>labelled</code>. The function <code><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor()</a></code> is the main function to create factors from labels, but often you will need to do more manipulation before that.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ipumsr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>, <span class="kw">warn.conflicts</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># Note that you can pass in the loaded DDI into the `read_ipums_micro()`</span>
<span class="no">cps_ddi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_ddi.html">read_ipums_ddi</a></span>(<span class="fu"><a href="../reference/ipums_example.html">ipums_example</a></span>(<span class="st">"cps_00006.xml"</span>))
<span class="no">cps_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span>(<span class="no">cps_ddi</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># Show which variables have labels</span>
<span class="no">cps_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">select_if</a></span>(<span class="no">is.labelled</span>)
<span class="co">#&gt; # A tibble: 7,668 x 3</span>
<span class="co">#&gt;          STATEFIP     MONTH                               INCTOT</span>
<span class="co">#&gt;         &lt;int+lbl&gt; &lt;int+lbl&gt;                            &lt;dbl+lbl&gt;</span>
<span class="co">#&gt;  1 55 [Wisconsin] 3 [March]     4883                            </span>
<span class="co">#&gt;  2 55 [Wisconsin] 3 [March]     5800                            </span>
<span class="co">#&gt;  3 55 [Wisconsin] 3 [March] 99999998 [Missing.]                 </span>
<span class="co">#&gt;  4 27 [Minnesota] 3 [March]    14015                            </span>
<span class="co">#&gt;  5 27 [Minnesota] 3 [March]    16552                            </span>
<span class="co">#&gt;  6 27 [Minnesota] 3 [March]     6375                            </span>
<span class="co">#&gt;  7 19 [Iowa]      3 [March] 99999999 [N.I.U. (Not in Universe).]</span>
<span class="co">#&gt;  8 19 [Iowa]      3 [March]        0                            </span>
<span class="co">#&gt;  9 19 [Iowa]      3 [March]      600                            </span>
<span class="co">#&gt; 10 19 [Iowa]      3 [March] 99999999 [N.I.U. (Not in Universe).]</span>
<span class="co">#&gt; # ... with 7,658 more rows</span>

<span class="co"># Notice how the tibble print function shows the dbl+lbl class on top</span>

<span class="co"># Investigate labels</span>
<span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span>(<span class="no">cps_data</span>$<span class="no">STATEFIP</span>)
<span class="co">#&gt; # A tibble: 75 x 2</span>
<span class="co">#&gt;      val lbl                 </span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;               </span>
<span class="co">#&gt;  1     1 Alabama             </span>
<span class="co">#&gt;  2     2 Alaska              </span>
<span class="co">#&gt;  3     4 Arizona             </span>
<span class="co">#&gt;  4     5 Arkansas            </span>
<span class="co">#&gt;  5     6 California          </span>
<span class="co">#&gt;  6     8 Colorado            </span>
<span class="co">#&gt;  7     9 Connecticut         </span>
<span class="co">#&gt;  8    10 Delaware            </span>
<span class="co">#&gt;  9    11 District of Columbia</span>
<span class="co">#&gt; 10    12 Florida             </span>
<span class="co">#&gt; # ... with 65 more rows</span>

<span class="co"># Convert the labels to factors (and drop the unused levels)</span>
<span class="no">cps_data</span> <span class="kw">&lt;-</span> <span class="no">cps_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">STATE_factor</span> <span class="kw">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span>(<span class="fu"><a href="../reference/lbl_clean.html">lbl_clean</a></span>(<span class="no">STATEFIP</span>)))

<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">cps_data</span>$<span class="no">STATE_factor</span>, <span class="kw">useNA</span> <span class="kw">=</span> <span class="st">"always"</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;         Iowa    Minnesota North Dakota South Dakota    Wisconsin         &lt;NA&gt; </span>
<span class="co">#&gt;         1892         2362          188          227         2999            0</span></pre></body></html></div>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Manipulating the labelled value before as_factor </span>
<span class="co"># often leads to losing the information...</span>
<span class="co"># Say we want to set Iowa (STATEFIP == 19) to missing</span>
<span class="no">cps_data</span> <span class="kw">&lt;-</span> <span class="no">cps_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">STATE_factor2</span> <span class="kw">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">STATEFIP</span> <span class="kw">==</span> <span class="fl">19</span>, <span class="fl">NA</span>, <span class="no">STATEFIP</span>)))</pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># ipumsr provides helpers for these kinds of tasks, like lbl_na_if().</span>
<span class="co"># See the value-labels vignette for more information</span>
<span class="no">cps_data</span> <span class="kw">&lt;-</span> <span class="no">cps_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">STATE_factor3</span> <span class="kw">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span>(<span class="fu"><a href="../reference/lbl_na_if.html">lbl_na_if</a></span>(<span class="no">STATEFIP</span>, ~<span class="no">.val</span> <span class="kw">==</span> <span class="fl">19</span>)))

<span class="co"># The as_factor function also has a "levels" argument that can </span>
<span class="co"># put both the labels and values into the factor</span>
<span class="no">cps_data</span> <span class="kw">&lt;-</span> <span class="no">cps_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">STATE_factor4</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span>(<span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span>(<span class="no">STATEFIP</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="st">"both"</span>)))

<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">cps_data</span>$<span class="no">STATE_factor4</span>, <span class="kw">useNA</span> <span class="kw">=</span> <span class="st">"always"</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;         [19] Iowa    [27] Minnesota [38] North Dakota [46] South Dakota </span>
<span class="co">#&gt;              1892              2362               188               227 </span>
<span class="co">#&gt;    [55] Wisconsin              &lt;NA&gt; </span>
<span class="co">#&gt;              2999                 0</span></pre></body></html></div>
</div>
<div id="other-ipums-attributes" class="section level3">
<h3 class="hasAnchor">
<a href="#other-ipums-attributes" class="anchor"></a>Other IPUMS attributes</h3>
<p>As with value labels, the other attributes that <code>ipumsr</code> stores about the data are often lost during an analysis. One way to deal with this is to load the DDI or codebook in addition to the actual data using the functions <code><a href="../reference/read_ipums_ddi.html">read_ipums_ddi()</a></code> and <code><a href="../reference/read_ipums_codebook.html">read_ipums_codebook()</a></code>. This way, when you wish to refer to variable labels or other metadata, you can use the DDI object, which does not get modified during your analysis.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ipumsr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>, <span class="kw">warn.conflicts</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># Note that you can pass in the loaded DDI into the `read_ipums_micro()`</span>
<span class="no">cps_ddi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_ddi.html">read_ipums_ddi</a></span>(<span class="fu"><a href="../reference/ipums_example.html">ipums_example</a></span>(<span class="st">"cps_00006.xml"</span>))
<span class="no">cps_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span>(<span class="no">cps_ddi</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># Currently variable description is available for year</span>
<span class="fu"><a href="../reference/ipums_var_info.html">ipums_var_desc</a></span>(<span class="no">cps_data</span>$<span class="no">YEAR</span>)
<span class="co">#&gt; [1] "YEAR reports the year in which the survey was conducted.  YEARP is repeated on person records."</span>

<span class="co"># But after using ifelse it is gone</span>
<span class="no">cps_data</span> <span class="kw">&lt;-</span> <span class="no">cps_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">YEAR</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">YEAR</span> <span class="kw">==</span> <span class="fl">1962</span>, <span class="fl">62</span>, <span class="fl">NA</span>))
<span class="fu"><a href="../reference/ipums_var_info.html">ipums_var_desc</a></span>(<span class="no">cps_data</span>$<span class="no">YEAR</span>)
<span class="co">#&gt; [1] NA</span>

<span class="co"># So you can use the DDI</span>
<span class="fu"><a href="../reference/ipums_var_info.html">ipums_var_desc</a></span>(<span class="no">cps_ddi</span>, <span class="st">"YEAR"</span>)
<span class="co">#&gt; [1] "YEAR reports the year in which the survey was conducted.  YEARP is repeated on person records."</span>

<span class="co"># The DDI also has file level information that is not available from just</span>
<span class="co"># the data.</span>
<span class="fu"><a href="../reference/ipums_file_info.html">ipums_file_info</a></span>(<span class="no">cps_ddi</span>, <span class="st">"extract_notes"</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>()
<span class="co">#&gt; User-provided description:  Minimal test extract</span>
<span class="co">#&gt; Samples: 1962, 1963</span>
<span class="co">#&gt; Variables: STATEFIP, INCTOT (automatically Year, SERIAL, HWTSUPP, MONTH, WTSUPP)</span>
<span class="co">#&gt; Select Cases: State - Minnesota, Iowa, Wisconsin, South Dakota, North Dakota</span></pre></body></html></div>
</div>
<div id="dplyr-select-style-syntax" class="section level3">
<h3 class="hasAnchor">
<a href="#dplyr-select-style-syntax" class="anchor"></a>“dplyr select-style” Syntax</h3>
<p>Several functions within the <code>ipumsr</code> package allow for “dplyr select-style” syntax. This means that they accept either a character vector of values (e.g. <code><a href="https://rdrr.io/r/base/c.html">c("YEAR", "AGE")</a></code>), bare vectors of values (e.g. <code><a href="https://rdrr.io/r/base/c.html">c(YEAR, AGE)</a></code>) and the helper functions allowed in <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code> (e.g. <code><a href="https://tidyselect.r-lib.org/reference/one_of.html">one_of(c("YEAR", "AGE"))</a></code>).</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ipumsr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>, <span class="kw">warn.conflicts</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># The vars argument for `read_ipums_micro` uses this syntax</span>
<span class="co"># So these are all equivalent</span>
<span class="no">cf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ipums_example.html">ipums_example</a></span>(<span class="st">"cps_00006.xml"</span>)
<span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span>(<span class="no">cf</span>, <span class="kw">vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"YEAR"</span>, <span class="st">"INCTOT"</span>), <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>()
<span class="co">#&gt; [1] "YEAR"   "INCTOT"</span>

<span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span>(<span class="no">cf</span>, <span class="kw">vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">YEAR</span>, <span class="no">INCTOT</span>), <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>()
<span class="co">#&gt; [1] "YEAR"   "INCTOT"</span>

<span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span>(<span class="no">cf</span>, <span class="kw">vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://tidyselect.r-lib.org/reference/one_of.html">one_of</a></span>(<span class="st">"YEAR"</span>), <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span>(<span class="st">"INC"</span>)), <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>()
<span class="co">#&gt; [1] "YEAR"   "INCTOT"</span>

<span class="co"># `data_layer` and `shape_layer` arguments to `read_nhgis()` and terra functions</span>
<span class="co"># also use it.</span>
<span class="co"># (Sometimes extracts have multiple files, though all examples only have one)</span>
<span class="no">nf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ipums_example.html">ipums_example</a></span>(<span class="st">"nhgis0008_csv.zip"</span>)
<span class="fu"><a href="../reference/ipums_list_files.html">ipums_list_files</a></span>(<span class="no">nf</span>)
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   type  file                                       </span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                                      </span>
<span class="co">#&gt; 1 data  nhgis0008_csv/nhgis0008_ds135_1990_pmsa.csv</span>

<span class="fu"><a href="../reference/ipums_list_files.html">ipums_list_files</a></span>(<span class="no">nf</span>, <span class="kw">data_layer</span> <span class="kw">=</span> <span class="st">"nhgis0008_csv/nhgis0008_ds135_1990_pmsa.csv"</span>)
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   type  file                                       </span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                                      </span>
<span class="co">#&gt; 1 data  nhgis0008_csv/nhgis0008_ds135_1990_pmsa.csv</span>

<span class="fu"><a href="../reference/ipums_list_files.html">ipums_list_files</a></span>(<span class="no">nf</span>, <span class="kw">data_layer</span> <span class="kw">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span>(<span class="st">"ds135"</span>))
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   type  file                                       </span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                                      </span>
<span class="co">#&gt; 1 data  nhgis0008_csv/nhgis0008_ds135_1990_pmsa.csv</span></pre></body></html></div>
</div>
<div id="hierarchical-data-structures" class="section level3">
<h3 class="hasAnchor">
<a href="#hierarchical-data-structures" class="anchor"></a>Hierarchical data structures</h3>
<p>For certain IPUMS projects, the data is hierarchical, multiple people are included in a single household, or multiple activities are performed by a single person. The <code>ipumsr</code> package provides two data structures for storing such data (for users who did not select the “rectangularize” option on the website). The data can be loaded as a <code>"list"</code> or <code>"long"</code>.</p>
<p><strong>List</strong> data loads each record type into a separate data.frame. The names of the recordtype data.frames are the value of the RECTYPE variable (e.g. “H” and “P”). Use the function <code><a href="../reference/read_ipums_micro.html">read_ipums_micro_list()</a></code> to load the data this way.</p>
<p><strong>Long</strong> data has one row per unit, regardless of what type of record the unit is. Therefore, datasets loaded this way often contain variables with a large number of missings, for the variables that only apply to certain record types. Use the function <code><a href="../reference/read_ipums_micro.html">read_ipums_micro()</a></code> to load the data this way.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ipumsr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>, <span class="kw">warn.conflicts</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># List data</span>
<span class="no">cps</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro_list</a></span>(
  <span class="fu"><a href="../reference/ipums_example.html">ipums_example</a></span>(<span class="st">"cps_00010.xml"</span>),
  <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>
)

<span class="no">cps</span>$<span class="no">PERSON</span>
<span class="co">#&gt; # A tibble: 7,668 x 6</span>
<span class="co">#&gt;    RECTYPE           YEAR SERIAL PERNUM WTSUPP                            INCTOT</span>
<span class="co">#&gt;    &lt;chr+lbl&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;                         &lt;dbl+lbl&gt;</span>
<span class="co">#&gt;  1 P [Person Recor~  1962     80      1  1476.     4883                         </span>
<span class="co">#&gt;  2 P [Person Recor~  1962     80      2  1471.     5800                         </span>
<span class="co">#&gt;  3 P [Person Recor~  1962     80      3  1579. 99999998 [Missing.]              </span>
<span class="co">#&gt;  4 P [Person Recor~  1962     82      1  1598.    14015                         </span>
<span class="co">#&gt;  5 P [Person Recor~  1962     83      1  1707.    16552                         </span>
<span class="co">#&gt;  6 P [Person Recor~  1962     84      1  1790.     6375                         </span>
<span class="co">#&gt;  7 P [Person Recor~  1962    107      1  4355. 99999999 [N.I.U. (Not in Univers~</span>
<span class="co">#&gt;  8 P [Person Recor~  1962    107      2  1386.        0                         </span>
<span class="co">#&gt;  9 P [Person Recor~  1962    107      3  1629.      600                         </span>
<span class="co">#&gt; 10 P [Person Recor~  1962    107      4  1432. 99999999 [N.I.U. (Not in Univers~</span>
<span class="co">#&gt; # ... with 7,658 more rows</span>

<span class="no">cps</span>$<span class="no">HOUSEHOLD</span>
<span class="co">#&gt; # A tibble: 3,385 x 6</span>
<span class="co">#&gt;    RECTYPE               YEAR SERIAL HWTSUPP       STATEFIP     MONTH</span>
<span class="co">#&gt;    &lt;chr+lbl&gt;            &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;      &lt;int+lbl&gt; &lt;int+lbl&gt;</span>
<span class="co">#&gt;  1 H [Household Record]  1962     80   1476. 55 [Wisconsin] 3 [March]</span>
<span class="co">#&gt;  2 H [Household Record]  1962     82   1598. 27 [Minnesota] 3 [March]</span>
<span class="co">#&gt;  3 H [Household Record]  1962     83   1707. 27 [Minnesota] 3 [March]</span>
<span class="co">#&gt;  4 H [Household Record]  1962     84   1790. 27 [Minnesota] 3 [March]</span>
<span class="co">#&gt;  5 H [Household Record]  1962    107   4355. 19 [Iowa]      3 [March]</span>
<span class="co">#&gt;  6 H [Household Record]  1962    108   1479. 19 [Iowa]      3 [March]</span>
<span class="co">#&gt;  7 H [Household Record]  1962    122   3603. 27 [Minnesota] 3 [March]</span>
<span class="co">#&gt;  8 H [Household Record]  1962    124   4104. 55 [Wisconsin] 3 [March]</span>
<span class="co">#&gt;  9 H [Household Record]  1962    125   2182. 55 [Wisconsin] 3 [March]</span>
<span class="co">#&gt; 10 H [Household Record]  1962    126   1826. 55 [Wisconsin] 3 [March]</span>
<span class="co">#&gt; # ... with 3,375 more rows</span>

<span class="co"># Long data</span>
<span class="no">cps</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span>(
  <span class="fu"><a href="../reference/ipums_example.html">ipums_example</a></span>(<span class="st">"cps_00010.xml"</span>),
  <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>
)

<span class="no">cps</span>
<span class="co">#&gt; # A tibble: 11,053 x 9</span>
<span class="co">#&gt;    RECTYPE    YEAR SERIAL HWTSUPP  STATEFIP    MONTH PERNUM WTSUPP        INCTOT</span>
<span class="co">#&gt;    &lt;chr+lbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;int+lbl&gt; &lt;int+lb&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl+lbl&gt;</span>
<span class="co">#&gt;  1 H [House~  1962     80   1476. 55 [Wisc~  3 [Mar~     NA    NA  NA           </span>
<span class="co">#&gt;  2 P [Perso~  1962     80     NA  NA        NA            1  1476.  4.88e3      </span>
<span class="co">#&gt;  3 P [Perso~  1962     80     NA  NA        NA            2  1471.  5.80e3      </span>
<span class="co">#&gt;  4 P [Perso~  1962     80     NA  NA        NA            3  1579.  1.00e8 [Mis~</span>
<span class="co">#&gt;  5 H [House~  1962     82   1598. 27 [Minn~  3 [Mar~     NA    NA  NA           </span>
<span class="co">#&gt;  6 P [Perso~  1962     82     NA  NA        NA            1  1598.  1.40e4      </span>
<span class="co">#&gt;  7 H [House~  1962     83   1707. 27 [Minn~  3 [Mar~     NA    NA  NA           </span>
<span class="co">#&gt;  8 P [Perso~  1962     83     NA  NA        NA            1  1707.  1.66e4      </span>
<span class="co">#&gt;  9 H [House~  1962     84   1790. 27 [Minn~  3 [Mar~     NA    NA  NA           </span>
<span class="co">#&gt; 10 P [Perso~  1962     84     NA  NA        NA            1  1790.  6.38e3      </span>
<span class="co">#&gt; # ... with 11,043 more rows</span></pre></body></html></div>
</div>
<div id="geospatial-packages-sf-vs-sp" class="section level3">
<h3 class="hasAnchor">
<a href="#geospatial-packages-sf-vs-sp" class="anchor"></a>Geospatial Packages: <code>sf</code> vs <code>sp</code>
</h3>
<p>The <code>ipumsr</code> package allows for loading geospatial data in two formats (sf for Simple Features and sp for Spatial). The <code>sf</code> package is relatively new, and so does not have as widespread support as the <code>sp</code> package. However, (in my opinion) it does allow for easier analysis, and so may be a better place to start if you have not used GIS data in R before.</p>
<p>For more details about how to load geographic data using ipumsr, see the vignette “ipums-geography” (<code><a href="../articles/ipums-geography.html">vignette("ipums-geography", package = "ipumsr")</a></code>)</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.ipums.org">IPUMS</a> at the University of Minnesota.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '4ffa912ace97d2493f6ed39f20e94316',
    indexName: 'ipumsr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
